<div ng-controller="LocationCtrl">
  <div class="row">
    <div class="col-md-3 mt-4">

      <h1> Locații </h1>
      <hr>
      <ul class="list-group">
        <li class="list-group-item" ng-repeat="loc in locations">
          <a href ng-click="selectLocation(loc)"> {{loc.name}} </a>
        </li>
        <li class="list-group-item" ng-repeat-end>
          <a href ng-click="location = {}"> Create new ... </a>
        </li>
      </ul>

    </div>
    <div class="col-md-9 mt-4" ng-show="location">

      <div class="location_map"></div>


      <h2 class="mt-4">{{location.name}}</h2>

      <hr>

      <div class="row ">

        <div class="col-sm-8 ">
          <form novalidate id="locationForm" name="locationForm">
            <div class="form-row form-group">
              <label class="col-form-label col-sm-2" for="address" required> Adresa </label>
              <div class="col-sm-10">
                <input id="address" class="form-control" required ng-model="location.address">
              </div>
            </div>
            <div class="form-row form-group">
              <label class="col-form-label col-sm-2" for="name"> Nume </label>
              <div class="col-sm-10">
                <input id="name" class="form-control" required ng-model="location.name">
                <small class="form-text ">Descriere a parcarii (companie, repere,etc) vizibila de catre client.</small>
              </div>

            </div>
            <div class="form-row form-group">
              <label class="col-form-label col-sm-2" for="soc_name"> Nume Societate </label>
              <div class="col-sm-10">
                <input id="soc_name" class="form-control" required ng-model="location.parking_space_name">
              </div>
            </div>
            <div class="form-row form-group">
              <label class="col-form-label col-sm-2" for="lat"> Lat </label>
              <div class="col-sm-10">
                <input id="lat" class="form-control" required ng-model="location.location_lat">
              </div>
            </div>
            <div class="form-row form-group">
              <label class="col-form-label col-sm-2" for="lng"> Lng </label>
              <div class="col-sm-10">
                <input id="lng" class="form-control" required ng-model="location.location_long">
              </div>
            </div>
            <button class="btn btn-primary" ng-click="saveSensorLocation()" ng-disabled="loading">
              <i class="fa fa-spinner fa-spin" ng-show="loading"></i>
              Salveaza
            </button>
            <button class="btn btn-danger" ng-click="deleteSensorLocation()" ng-disabled="loading">
              <i class="fa fa-spinner fa-spin" ng-show="loading"></i>
              Sterge
            </button>

          </form>
        </div>
        <div class="col-sm-4 text-center">
          <img height=176" src="<%= image_path 'phone_map_blue.png' %>">
        </div>
      </div>


      <div class="list-group my-4">
        <div ng-repeat="sensor in assignedSensors" class="list-group-item ">
          <div class="list-group-item-action d-flex justify-content-between">
            <div ui-sref=".sensor({sensorId: sensor.id})">
              <h5> {{sensor.location_text }} </h5>
              <span class="small"> {{sensor.lat}} x {{ sensor.lng }}</span>
            </div>
            <img height="100" ng-src="{{ 'https://res.cloudinary.com/'+cloudinaryName+'/image/upload/'+sensor.snapshot}}">
          </div>

          <button class="btn btn-link" ng-click="unassignSensor(sensor)">
            <i class="fa fa-trash"></i>
            Dezasigneaza Senzor
          </button>
        </div>

        <div ng-repeat-end class="list-group-item  list-group-item-action">
          <button class="btn btn-link" href="#" ng-hide="addNewSensor || !location.id" ng-click="assignNewSensor()"
                  ng-disabled="loading">
            <i class="fa fa-spinner fa-spin" ng-show="loading"></i>
            Asigneaza Senzor ...
          </button>
          <form novalidate id="newSensorForm" name="newSensorForm" ng-show="addNewSensor">
            <div class="form-row">
              <label class="col-form-label col-sm-3" for="sensor_name">
                Nume nou:
              </label>
              <div class="col-sm-9">
                <input class="form-control form-control-sm" required ng-model="newSensor.location_text" id="sensor_name">
              </div>
            </div>
            <div class="form-row">
              <label class="col-form-label col-sm-3" for="lat">
                Lat x Lng:
              </label>
              <div class="col-sm-4">
                <input class="form-control form-control-sm" ng-model="newSensor.lat" id="lat">
              </div>
              <div class="col-sm-1"> x</div>

              <div class="col-sm-4">
                <input class="form-control form-control-sm" ng-model="newSensor.lng" id="lng">
              </div>
            </div>
            <div class="form-row">
              <label class="col-form-label col-sm-3" for="sensor_name">
                Senzor:
              </label>
              <div class="col-sm-9">
                <select class="form-control form-control-sm" id="sensor_name" required
                        ng-options="sensor as sensor.title_message for sensor in sensors track by sensor.id"
                        ng-model="newSensor">
                  <option value="" selected="selected"> -- choose sensor --</option>
                </select>
              </div>
            </div>
            <button class="btn btn-sm btn-primary" ng-disabled="loading" ng-click="saveSensor()">
              <i class="fa fa-spinner fa-spin" ng-show="loading"></i>
              Salvează
            </button>
            <button class="btn btn-sm btn-secondary" ng-click="addNewSensor = null">Cancel</button>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- Edit sensor modal -->
  <ui-view name="detail"></ui-view>

</div>